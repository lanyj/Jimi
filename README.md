# Jimiï¼šæ‰“é€ Javaç¨‹åºå‘˜ä¸“å±çš„å¼€æºClaudeCode

> ä¸€ä¸ªå®Œå…¨ç”¨Javaå®ç°çš„AIé©±åŠ¨CLIæ™ºèƒ½ä»£ç†ç³»ç»Ÿï¼Œä¸ºJavaå¼€å‘è€…å¸¦æ¥å¯æ·±åº¦å®šåˆ¶çš„ç±»ClaudeCodeå¼€æºã€‚

[![Java](https://img.shields.io/badge/Java-17+-orange.svg)](https://www.oracle.com/java/)
[![Spring Boot](https://img.shields.io/badge/Spring%20Boot-3.2.5-brightgreen.svg)](https://spring.io/projects/spring-boot)
[![License](https://img.shields.io/badge/License-Apache%202.0-blue.svg)](LICENSE)

---

## ğŸ“– é¡¹ç›®ç®€ä»‹

Jimi æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„AIé©±åŠ¨çš„å‘½ä»¤è¡Œæ™ºèƒ½ä»£ç†ç³»ç»Ÿï¼Œå®ƒå°†å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„æ™ºèƒ½èƒ½åŠ›ä¸ä¸°å¯Œçš„å¼€å‘å·¥å…·ç”Ÿæ€ç³»ç»Ÿå®Œç¾ç»“åˆï¼Œä¸ºè½¯ä»¶å¼€å‘è€…æä¾›æ™ºèƒ½åŒ–çš„å¼€å‘åŠ©æ‰‹ä½“éªŒã€‚

### æ ¸å¿ƒä»·å€¼

- **ğŸš€ æå‡å¼€å‘æ•ˆç‡**ï¼šé€šè¿‡AIè‡ªåŠ¨åŒ–å®Œæˆé‡å¤æ€§å·¥ä½œï¼Œè®©å¼€å‘è€…ä¸“æ³¨äºåˆ›é€ æ€§ä»»åŠ¡
- **ğŸ§  æ™ºèƒ½å†³ç­–æ”¯æŒ**ï¼šæä¾›å³æ—¶çš„æŠ€æœ¯å’¨è¯¢ã€ä»£ç å»ºè®®å’Œæœ€ä½³å®è·µæŒ‡å¯¼
- **ğŸ”§ å·¥å…·é›†æˆå¹³å°**ï¼šç»Ÿä¸€çš„å·¥å…·è°ƒç”¨æ¥å£ï¼Œæ”¯æŒæ–‡ä»¶æ“ä½œã€Shellå‘½ä»¤ã€ç½‘ç»œè®¿é—®ç­‰
- **ğŸ¯ ä¸“ä¸šåŒ–åˆ†å·¥**ï¼šå¤šAgentåä½œæœºåˆ¶ï¼Œä¸åŒAgentä¸“æ³¨ä¸åŒé¢†åŸŸï¼ˆè®¾è®¡ã€ç¼–ç ã€å®¡æŸ¥ç­‰ï¼‰
- **ğŸ“š çŸ¥è¯†æ³¨å…¥ç³»ç»Ÿ**ï¼šSkillsåŠŸèƒ½æ”¯æŒé¢†åŸŸçŸ¥è¯†çš„æ¨¡å—åŒ–æ³¨å…¥å’Œè‡ªåŠ¨æ¿€æ´»

### ä¸»è¦ç”¨é€”

- ä»£ç ç”Ÿæˆä¸é‡æ„
- æŠ€æœ¯é—®é¢˜è¯Šæ–­ä¸è§£å†³
- ä»£ç å®¡æŸ¥ä¸è´¨é‡åˆ†æ
- è‡ªåŠ¨åŒ–ä»»åŠ¡æ‰§è¡Œ
- é¡¹ç›®æ¶æ„è®¾è®¡ä¸å’¨è¯¢
- æ–‡æ¡£ç”Ÿæˆä¸ç»´æŠ¤

---

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸ¤– CLIæ™ºèƒ½ä»£ç†
- è‡ªç„¶è¯­è¨€äº¤äº’ç•Œé¢
- äº¤äº’å¼Shellç¯å¢ƒï¼ˆåŸºäºJLineï¼‰
- ä¸°å¯Œçš„å…ƒå‘½ä»¤æ”¯æŒï¼ˆ`/help`ã€`/status`ã€`/tools`ç­‰ï¼‰
- å½©è‰²è¾“å‡ºä¸ä¸­æ–‡å‹å¥½çš„è‡ªåŠ¨æ¢è¡Œ

### ğŸ­ å¤šAgentæ”¯æŒ
- **é»˜è®¤Agent**ï¼šé€šç”¨å¼€å‘åŠ©æ‰‹
- **è®¾è®¡Agent**ï¼šéœ€æ±‚åˆ†æã€æ¶æ„è®¾è®¡ã€æŠ€æœ¯é€‰å‹
- **ç¼–ç Agent**ï¼šä»£ç å®ç°ã€é‡æ„ã€ä¼˜åŒ–
- **å®¡æŸ¥Agent**ï¼šä»£ç è´¨é‡å®¡æŸ¥ã€å®‰å…¨å®¡è®¡
- **æ„å»ºAgent**ï¼šé¡¹ç›®æ„å»ºã€ä¾èµ–ç®¡ç†
- **è‡ªå®šä¹‰Agent**ï¼šæ”¯æŒYAMLé…ç½®è‡ªå®šä¹‰Agent

### ğŸ”„ å¼‚æ­¥å­ä»£ç†ï¼ˆAsync Subagentï¼‰
- **åå°ç‹¬ç«‹è¿è¡Œ**ï¼šå­ä»£ç†åœ¨åå°æ‰§è¡Œï¼Œä¸»ä»£ç†å¯ç»§ç»­å¤„ç†å…¶ä»–ä»»åŠ¡
- **ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼šæ”¯æŒå¯åŠ¨ã€çŠ¶æ€æŸ¥è¯¢ã€å–æ¶ˆã€ç»“æœè·å–
- **å¤šä»£ç†å¹¶è¡Œ**ï¼šå¯åŒæ—¶è¿è¡Œå¤šä¸ªåå°å­ä»£ç†ï¼Œäº’ä¸å¹²æ‰°
- **äº‹ä»¶é€šçŸ¥æœºåˆ¶**ï¼šå®æ—¶æ¥æ”¶å­ä»£ç†å¯åŠ¨ã€è¿›åº¦ã€å®Œæˆé€šçŸ¥
- **è¶…æ—¶æ§åˆ¶**ï¼šå¯è®¾ç½®æ‰§è¡Œè¶…æ—¶ï¼Œé˜²æ­¢èµ„æºå ç”¨
- **é€‚ç”¨åœºæ™¯**ï¼šé•¿æ—¶é—´æ„å»ºã€æ—¥å¿—ç›‘æ§ã€å¹¶è¡Œä»»åŠ¡å¤„ç†

### ğŸ§© Skillsç³»ç»Ÿ
- é¢†åŸŸçŸ¥è¯†æ¨¡å—åŒ–ç®¡ç†
- å…³é”®è¯è‡ªåŠ¨åŒ¹é…æ¿€æ´»
- å›¢é˜ŸçŸ¥è¯†å…±äº«ä¸å¤ç”¨
- é«˜æ€§èƒ½ç¼“å­˜æœºåˆ¶ï¼ˆCaffeineï¼‰

### ğŸª Hooksç³»ç»Ÿ
- äº‹ä»¶é©±åŠ¨çš„è‡ªåŠ¨åŒ–æœºåˆ¶
- æ”¯æŒå·¥å…·è°ƒç”¨ã€Agentåˆ‡æ¢ã€é”™è¯¯å¤„ç†ç­‰å¤šç§Hookç±»å‹
- YAMLé…ç½®,æ”¯æŒçƒ­åŠ è½½
- æ¡ä»¶æ‰§è¡Œä¸å˜é‡æ›¿æ¢
- ä¼˜å…ˆçº§æ§åˆ¶ä¸å¼‚æ­¥æ‰§è¡Œ

### ğŸ” ä»£ç å›¾(Code Graph)
- åŸºäºLocAgentè®ºæ–‡çš„ä»£ç ç†è§£èƒ½åŠ›
- ASTå›¾æ„å»ºä¸æŒä¹…åŒ–å­˜å‚¨
- æ··åˆæ£€ç´¢(å›¾æ£€ç´¢ + å‘é‡æ£€ç´¢)
- å½±å“åˆ†æã€è°ƒç”¨å›¾æŸ¥è¯¢ã€å¯è§†åŒ–
- æ™ºèƒ½ä»£ç å®šä½ä¸å¯¼èˆª

### âš¡ è‡ªå®šä¹‰å‘½ä»¤ç³»ç»Ÿ
- YAMLé…ç½®æ–‡ä»¶å®šä¹‰å‘½ä»¤
- æ”¯æŒScript/Agent/Compositeç±»å‹
- å‚æ•°å®šä¹‰ä¸å‰ç½®æ¡ä»¶æ£€æŸ¥
- æ— éœ€ç¼–å†™Javaä»£ç å³å¯æ‰©å±•
- æ”¯æŒå‘½ä»¤åˆ«åä¸ä¼˜å…ˆçº§

### ğŸ§  ReCAPè®°å¿†ä¼˜åŒ–
- æœ‰ç•Œæ´»åŠ¨æç¤º,ä¿æŒæç¤ºå¤§å°O(1)
- ç»“æ„åŒ–ä¸Šä¸‹æ–‡æ¢å¤æœºåˆ¶
- å…³é”®å‘ç°å‹ç¼©ä¸æ»‘çª—ç®¡ç†
- æ”¯æŒé€’å½’Subagentåä½œ
- Tokenæ¶ˆè€—ä¼˜åŒ–(èŠ‚çœ30-50%)

### ğŸ”Œ LLMé›†æˆ
- æ”¯æŒå¤šç§LLMæä¾›å•†ï¼ˆOpenAIã€Moonshotç­‰ï¼‰
- çµæ´»çš„æ¨¡å‹åˆ‡æ¢
- æµå¼å“åº”å¤„ç†
- ä¸Šä¸‹æ–‡æ™ºèƒ½å‹ç¼©

### ğŸŒ MCPåè®®æ”¯æŒ
- Model Context Protocolæ ‡å‡†é›†æˆ
- HTTPå’ŒStdIOä¸¤ç§é€šä¿¡æ–¹å¼
- å¤–éƒ¨å·¥å…·æœåŠ¡é›†æˆ
- ç¤ºä¾‹é…ç½®ï¼ˆæ•°æ®åº“ã€æ–‡ä»¶ç³»ç»Ÿã€Gitã€GitHubç­‰ï¼‰

### ğŸ› ï¸ ä¸°å¯Œçš„å·¥å…·ç³»ç»Ÿ
- **æ–‡ä»¶æ“ä½œ**ï¼šè¯»å–ã€å†™å…¥ã€æœç´¢ã€è¡¥ä¸åº”ç”¨
- **Shellæ‰§è¡Œ**ï¼šå‘½ä»¤æ‰§è¡Œä¸ç»“æœæ•è·
- **ç½‘ç»œå·¥å…·**ï¼šç½‘é¡µå†…å®¹æŠ“å–ã€HTTPè¯·æ±‚
- **å¾…åŠäº‹é¡¹**ï¼šä»»åŠ¡ç®¡ç†ä¸è¿½è¸ª
- **å­Agentä»»åŠ¡å§”æ‰˜**ï¼šå¤æ‚ä»»åŠ¡åˆ†è§£ä¸å¹¶è¡Œå¤„ç†ï¼ˆæ”¯æŒåŒæ­¥/å¼‚æ­¥ä¸¤ç§æ¨¡å¼ï¼‰
- **MCPå·¥å…·**ï¼šåŠ¨æ€åŠ è½½å¤–éƒ¨å·¥å…·
- **äººå·¥äº¤äº’**ï¼šask_humanå·¥å…·æ”¯æŒæ‰§è¡Œä¸­æš‚åœç­‰å¾…ç”¨æˆ·è¾“å…¥
- **ä»£ç å›¾å·¥å…·**ï¼šä»£ç å®šä½ã€å½±å“åˆ†æã€è°ƒç”¨å›¾æŸ¥è¯¢
- **ä»£ç ç¼–æ’å·¥å…·ï¼ˆMetaToolï¼‰**ï¼šæ”¯æŒé€šè¿‡Javaä»£ç ç¼–æ’å¤šå·¥å…·è°ƒç”¨ï¼Œå‡å°‘30-40% context tokenæ¶ˆè€—

### ğŸ” é«˜çº§åŠŸèƒ½
- **ä¸Šä¸‹æ–‡å‹ç¼©**ï¼šæ™ºèƒ½æ¶ˆæ¯å‹ç¼©ï¼ŒèŠ‚çœToken
- **å®¡æ‰¹æœºåˆ¶**ï¼šæ•æ„Ÿæ“ä½œçš„äººå·¥å®¡æ‰¹æ§åˆ¶
- **YOLOæ¨¡å¼**ï¼šè‡ªåŠ¨æ‰¹å‡†æ‰€æœ‰æ“ä½œï¼Œæå‡æ•ˆç‡
- **å¾ªç¯æ§åˆ¶**ï¼šæœ€å¤§æ­¥æ•°ä¸è¿è¡Œæ—¶é—´é™åˆ¶
- **ä¼šè¯ç®¡ç†**ï¼šä¼šè¯æŒä¹…åŒ–ä¸æ¢å¤

---

## ğŸ›ï¸ å…¨å±€æ¶æ„

### ç³»ç»Ÿæ•´ä½“æ¶æ„

```mermaid
graph TB
    subgraph ç”¨æˆ·äº¤äº’å±‚
        CLI[CLIå‘½ä»¤è¡Œ]
        Shell[JLine Shell]
    end
    
    subgraph æ ¸å¿ƒå¼•æ“å±‚
        Engine[JimiEngine]
        Executor[AgentExecutor]
        Context[ExecutionContext]
        Approval[å®¡æ‰¹æœºåˆ¶]
        Compaction[ä¸Šä¸‹æ–‡å‹ç¼©]
        Memory[ReCAPè®°å¿†ä¼˜åŒ–]
        Interaction[äººå·¥äº¤äº’]
    end
    
    subgraph Agentç³»ç»Ÿ
        AgentRegistry[Agentæ³¨å†Œè¡¨]
        DefaultAgent[é»˜è®¤Agent]
        DesignAgent[è®¾è®¡Agent]
        CodeAgent[ç¼–ç Agent]
        ReviewAgent[å®¡æŸ¥Agent]
    end
    
    subgraph å·¥å…·ç³»ç»Ÿ
        ToolRegistry[å·¥å…·æ³¨å†Œè¡¨]
        FileTools[æ–‡ä»¶å·¥å…·]
        BashTools[Shellå·¥å…·]
        WebTools[ç½‘ç»œå·¥å…·]
        MCPTools[MCPå·¥å…·]
        SubagentTools[å­Agentå·¥å…·]
        GraphTools[ä»£ç å›¾å·¥å…·]
        HumanTools[äººå·¥äº¤äº’å·¥å…·]
    end
    
    subgraph LLMé›†æˆå±‚
        LLMFactory[LLMå·¥å‚]
        ChatProvider[èŠå¤©æä¾›å•†]
        OpenAI[OpenAI]
        Moonshot[Moonshot]
    end
    
    subgraph Skillsç³»ç»Ÿ
        SkillRegistry[Skillsæ³¨å†Œè¡¨]
        SkillMatcher[SkillsåŒ¹é…å™¨]
        SkillLoader[SkillsåŠ è½½å™¨]
    end
    
    subgraph Hooksç³»ç»Ÿ
        HookRegistry[Hooksæ³¨å†Œè¡¨]
        HookExecutor[Hooksæ‰§è¡Œå™¨]
        HookLoader[HooksåŠ è½½å™¨]
    end
    
    subgraph ä»£ç å›¾ç³»ç»Ÿ
        GraphManager[Graphç®¡ç†å™¨]
        GraphBuilder[å›¾æ„å»ºå™¨]
        GraphSearch[å›¾æ£€ç´¢å¼•æ“]
        ImpactAnalyzer[å½±å“åˆ†æå™¨]
    end
    
    subgraph è‡ªå®šä¹‰å‘½ä»¤
        CommandRegistry[å‘½ä»¤æ³¨å†Œè¡¨]
        CustomCommands[è‡ªå®šä¹‰å‘½ä»¤]
    end
    
    subgraph å¤–éƒ¨æœåŠ¡
        MCPServer[MCPæœåŠ¡]
        Database[æ•°æ®åº“æœåŠ¡]
        GitService[GitæœåŠ¡]
    end
    
    CLI --> Shell
    Shell --> Engine
    Shell --> CommandRegistry
    Engine --> Executor
    Executor --> Context
    Executor --> AgentRegistry
    Executor --> ToolRegistry
    Executor --> LLMFactory
    Executor --> HookExecutor
    AgentRegistry --> DefaultAgent
    AgentRegistry --> DesignAgent
    AgentRegistry --> CodeAgent
    AgentRegistry --> ReviewAgent
    ToolRegistry --> FileTools
    ToolRegistry --> BashTools
    ToolRegistry --> WebTools
    ToolRegistry --> MCPTools
    ToolRegistry --> SubagentTools
    ToolRegistry --> GraphTools
    ToolRegistry --> HumanTools
    LLMFactory --> ChatProvider
    ChatProvider --> OpenAI
    ChatProvider --> Moonshot
    Engine --> Approval
    Engine --> Compaction
    Engine --> Memory
    Engine --> Interaction
    Engine --> SkillRegistry
    Engine --> GraphManager
    SkillRegistry --> SkillMatcher
    SkillRegistry --> SkillLoader
    HookRegistry --> HookExecutor
    HookRegistry --> HookLoader
    GraphManager --> GraphBuilder
    GraphManager --> GraphSearch
    GraphManager --> ImpactAnalyzer
    CommandRegistry --> CustomCommands
    MCPTools --> MCPServer
    MCPServer --> Database
    MCPServer --> GitService
```

### æ ¸å¿ƒæ‰§è¡Œæµç¨‹

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·
    participant Shell as Shell UI
    participant Engine as JimiEngine
    participant Agent as Agent
    participant LLM as LLM Provider
    participant Tool as Tool System
    
    User->>Shell: è¾“å…¥æŒ‡ä»¤
    Shell->>Engine: ä¼ é€’ç”¨æˆ·æ¶ˆæ¯
    Engine->>Agent: é€‰æ‹©åˆé€‚çš„Agent
    Agent->>Engine: è·å–ç³»ç»Ÿæç¤ºè¯
    Engine->>LLM: å‘é€æ¶ˆæ¯(å«å·¥å…·å®šä¹‰)
    
    loop å¤šè½®æ¨ç†
        LLM-->>Engine: è¿”å›å“åº”(å¯èƒ½å«å·¥å…·è°ƒç”¨)
        
        alt åŒ…å«å·¥å…·è°ƒç”¨
            Engine->>Tool: æ‰§è¡Œå·¥å…·
            Tool-->>Engine: è¿”å›å·¥å…·ç»“æœ
            Engine->>LLM: å‘é€å·¥å…·ç»“æœ
        else çº¯æ–‡æœ¬å“åº”
            Engine-->>Shell: è¿”å›æ–‡æœ¬
            Shell-->>User: æ˜¾ç¤ºç»“æœ
        end
    end
```

### Agentåä½œæœºåˆ¶

```mermaid
graph LR
    subgraph ä¸»Agent
        DefaultAgent[é»˜è®¤Agent]
    end
    
    subgraph ä¸“ä¸šAgent
        DesignAgent[è®¾è®¡Agent<br/>éœ€æ±‚åˆ†æ/æ¶æ„è®¾è®¡]
        CodeAgent[ç¼–ç Agent<br/>ä»£ç å®ç°/é‡æ„]
        ReviewAgent[å®¡æŸ¥Agent<br/>ä»£ç è´¨é‡/å®‰å…¨]
        TestAgent[æµ‹è¯•Agent<br/>æµ‹è¯•è¿è¡Œ/åˆ†æ]
        BuildAgent[æ„å»ºAgent<br/>ç¼–è¯‘/ä¾èµ–]
        DebugAgent[è°ƒè¯•Agent<br/>é”™è¯¯ä¿®å¤]
        DocAgent[æ–‡æ¡£Agent<br/>æ–‡æ¡£ç¼–å†™]
    end
    
    DefaultAgent -->|è®¾è®¡ä»»åŠ¡| DesignAgent
    DefaultAgent -->|ç¼–ç ä»»åŠ¡| CodeAgent
    DefaultAgent -->|å®¡æŸ¥ä»»åŠ¡| ReviewAgent
    DefaultAgent -->|æµ‹è¯•ä»»åŠ¡| TestAgent
    DefaultAgent -->|æ„å»ºä»»åŠ¡| BuildAgent
    DefaultAgent -->|è°ƒè¯•ä»»åŠ¡| DebugAgent
    DefaultAgent -->|æ–‡æ¡£ä»»åŠ¡| DocAgent
    
    DesignAgent -.->|è®¾è®¡å®Œæˆ| CodeAgent
    CodeAgent -.->|å®ç°å®Œæˆ| ReviewAgent
    ReviewAgent -.->|å®¡æŸ¥é€šè¿‡| TestAgent
```

### å·¥å…·ç³»ç»Ÿæ¶æ„

```mermaid
graph TD
    subgraph å·¥å…·æ³¨å†Œæœºåˆ¶
        ToolRegistry[å·¥å…·æ³¨å†Œè¡¨]
        ToolProvider[å·¥å…·æä¾›è€…æ¥å£]
        ToolRegistryFactory[å·¥å…·æ³¨å†Œè¡¨å·¥å‚]
    end
    
    subgraph å†…ç½®å·¥å…·
        FileTools[æ–‡ä»¶æ“ä½œå·¥å…·]
        ReadFile[ReadFile]
        WriteFile[WriteFile]
        SearchFile[SearchFile]
        PatchFile[PatchFile]
        
        BashTools[Shellå·¥å…·]
        RunCommand[RunCommand]
        
        WebTools[ç½‘ç»œå·¥å…·]
        FetchURL[FetchURL]
        SearchWeb[SearchWeb]
        
        ThinkTools[æ€è€ƒå·¥å…·]
        Think[Think]
        
        TodoTools[å¾…åŠå·¥å…·]
        ManageTodo[ManageTodo]
        
        HumanTools[äººå·¥äº¤äº’å·¥å…·]
        AskHuman[AskHuman]
    end
    
    subgraph ä»£ç å›¾å·¥å…·
        GraphTools[ä»£ç å›¾å·¥å…·]
        CodeLocate[CodeLocate]
        ImpactAnalysis[ImpactAnalysis]
        CallGraph[CallGraph]
    end
    
    subgraph å¤–éƒ¨å·¥å…·
        MCPTools[MCPå·¥å…·]
        MCPClient[MCPå®¢æˆ·ç«¯]
        HttpClient[HTTPå®¢æˆ·ç«¯]
        StdioClient[StdIOå®¢æˆ·ç«¯]
    end
    
    subgraph å­Agentå·¥å…·
        SubagentTools[å­Agentä»»åŠ¡]
        DelegateTask[ä»»åŠ¡å§”æ‰˜]
    end
    
    ToolRegistryFactory --> ToolRegistry
    ToolProvider --> ToolRegistry
    
    ToolRegistry --> FileTools
    ToolRegistry --> BashTools
    ToolRegistry --> WebTools
    ToolRegistry --> ThinkTools
    ToolRegistry --> TodoTools
    ToolRegistry --> HumanTools
    ToolRegistry --> GraphTools
    ToolRegistry --> MCPTools
    ToolRegistry --> SubagentTools
    
    FileTools --> ReadFile
    FileTools --> WriteFile
    FileTools --> SearchFile
    FileTools --> PatchFile
    
    BashTools --> RunCommand
    
    WebTools --> FetchURL
    WebTools --> SearchWeb
    
    ThinkTools --> Think
    
    TodoTools --> ManageTodo
    
    HumanTools --> AskHuman
    
    GraphTools --> CodeLocate
    GraphTools --> ImpactAnalysis
    GraphTools --> CallGraph
    
    MCPTools --> MCPClient
    MCPClient --> HttpClient
    MCPClient --> StdioClient
    
    SubagentTools --> DelegateTask
```

### æ¶ˆæ¯æ€»çº¿æ¶æ„

```mermaid
graph TB
    subgraph æ¶ˆæ¯æ€»çº¿Wire
        Wire[Wireæ¥å£]
        WireImpl[Wireå®ç°]
    end
    
    subgraph æ¶ˆæ¯ç±»å‹
        SystemMsg[ç³»ç»Ÿæ¶ˆæ¯]
        UserMsg[ç”¨æˆ·æ¶ˆæ¯]
        AssistantMsg[åŠ©æ‰‹æ¶ˆæ¯]
        ToolCallMsg[å·¥å…·è°ƒç”¨æ¶ˆæ¯]
        ToolResultMsg[å·¥å…·ç»“æœæ¶ˆæ¯]
        ErrorMsg[é”™è¯¯æ¶ˆæ¯]
        StatusMsg[çŠ¶æ€æ¶ˆæ¯]
    end
    
    subgraph æ¶ˆæ¯ç›‘å¬è€…
        ShellUI[Shell UI]
        Logger[æ—¥å¿—ç³»ç»Ÿ]
        SessionMgr[ä¼šè¯ç®¡ç†å™¨]
    end
    
    Wire --> WireImpl
    
    WireImpl --> SystemMsg
    WireImpl --> UserMsg
    WireImpl --> AssistantMsg
    WireImpl --> ToolCallMsg
    WireImpl --> ToolResultMsg
    WireImpl --> ErrorMsg
    WireImpl --> StatusMsg
    
    WireImpl -.-> ShellUI
    WireImpl -.-> Logger
    WireImpl -.-> SessionMgr
```

---

## ğŸ—ï¸ æŠ€æœ¯æ ˆ

### æ ¸å¿ƒæ¡†æ¶
- **Java 17**ï¼šç°ä»£Javaç‰¹æ€§æ”¯æŒ
- **Spring Boot 3.2.5**ï¼šä¼ä¸šçº§åº”ç”¨æ¡†æ¶
- **WebFlux**ï¼šå“åº”å¼ç¼–ç¨‹æ”¯æŒ

### å‘½ä»¤è¡Œä¸äº¤äº’
- **Picocli 4.7.6**ï¼šå‘½ä»¤è¡Œå‚æ•°è§£æ
- **JLine 3.25.1**ï¼šç»ˆç«¯äº¤äº’ä¸Shellå®ç°

### æ•°æ®å¤„ç†
- **Jackson 2.16.2**ï¼šJSONåºåˆ—åŒ–/ååºåˆ—åŒ–
- **SnakeYAML 2.2**ï¼šYAMLé…ç½®è§£æ

### å·¥å…·ä¸åº“
- **Apache Commons Exec**ï¼šè¿›ç¨‹æ‰§è¡Œ
- **Apache Commons Text**ï¼šæ–‡æœ¬å¤„ç†
- **Jsoup 1.17.2**ï¼šHTMLè§£æ
- **Java Diff Utils 4.12**ï¼šè¡¥ä¸æ“ä½œ
- **Caffeine 3.1.8**ï¼šé«˜æ€§èƒ½ç¼“å­˜

### å¼€å‘å·¥å…·
- **Lombok 1.18.32**ï¼šä»£ç ç®€åŒ–
- **SLF4J + Logback**ï¼šæ—¥å¿—ç®¡ç†
- **JUnit 5 + Mockito**ï¼šæµ‹è¯•æ¡†æ¶

### åè®®é›†æˆ
- **MCP SDK 0.12.1**ï¼šModel Context Protocolæ”¯æŒ

---

## ğŸ“‚ ç›®å½•ç»“æ„æ¦‚è§ˆ

```
src/main/java/io/leavesfly/jimi/
â”œâ”€â”€ agent/                  # Agentç³»ç»Ÿ
â”‚   â”œâ”€â”€ Agent.java          # Agentæ¥å£å®šä¹‰
â”‚   â”œâ”€â”€ AgentRegistry.java  # Agentæ³¨å†Œè¡¨
â”‚   â”œâ”€â”€ AgentSpec.java      # Agentè§„èŒƒ
â”‚   â””â”€â”€ AgentSpecLoader.java # Agentè§„èŒƒåŠ è½½å™¨
â”œâ”€â”€ cli/                    # å‘½ä»¤è¡Œå…¥å£
â”‚   â””â”€â”€ CliApplication.java # CLIåº”ç”¨ä¸»ç±»
â”œâ”€â”€ command/                # å‘½ä»¤å¤„ç†ç³»ç»Ÿ
â”‚   â”œâ”€â”€ custom/             # è‡ªå®šä¹‰å‘½ä»¤
â”‚   â”œâ”€â”€ handlers/           # å„ç§å‘½ä»¤å¤„ç†å™¨
â”‚   â”œâ”€â”€ CommandContext.java # å‘½ä»¤ä¸Šä¸‹æ–‡
â”‚   â”œâ”€â”€ CommandHandler.java # å‘½ä»¤å¤„ç†å™¨æ¥å£
â”‚   â””â”€â”€ CommandRegistry.java # å‘½ä»¤æ³¨å†Œè¡¨
â”œâ”€â”€ config/                 # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ ConfigLoader.java   # é…ç½®åŠ è½½å™¨
â”‚   â”œâ”€â”€ JimiConfig.java     # ä¸»é…ç½®ç±»
â”‚   â”œâ”€â”€ LLMModelConfig.java # LLMæ¨¡å‹é…ç½®
â”‚   â”œâ”€â”€ MemoryConfig.java   # è®°å¿†é…ç½®(ReCAP)
â”‚   â””â”€â”€ LoopControlConfig.java # å¾ªç¯æ§åˆ¶é…ç½®
â”œâ”€â”€ engine/                 # æ ¸å¿ƒå¼•æ“
â”‚   â”œâ”€â”€ approval/           # å®¡æ‰¹æœºåˆ¶
â”‚   â”œâ”€â”€ compaction/         # ä¸Šä¸‹æ–‡å‹ç¼©
â”‚   â”œâ”€â”€ context/            # ä¸Šä¸‹æ–‡ç®¡ç†
â”‚   â”œâ”€â”€ interaction/        # äººå·¥äº¤äº’
â”‚   â”œâ”€â”€ runtime/            # è¿è¡Œæ—¶çŠ¶æ€
â”‚   â”œâ”€â”€ toolcall/           # å·¥å…·è°ƒç”¨å¤„ç†
â”‚   â”œâ”€â”€ AgentExecutor.java  # Agentæ‰§è¡Œå™¨
â”‚   â”œâ”€â”€ Engine.java         # å¼•æ“æ¥å£
â”‚   â””â”€â”€ JimiEngine.java     # Jimiå¼•æ“å®ç°
â”œâ”€â”€ graph/                  # ä»£ç å›¾ç³»ç»Ÿ
â”‚   â”œâ”€â”€ builder/            # å›¾æ„å»ºå™¨
â”‚   â”œâ”€â”€ model/              # å›¾æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ navigator/          # å›¾å¯¼èˆª
â”‚   â”œâ”€â”€ parser/             # ASTè§£æå™¨
â”‚   â”œâ”€â”€ search/             # å›¾æ£€ç´¢å¼•æ“
â”‚   â”œâ”€â”€ store/              # å›¾å­˜å‚¨
â”‚   â”œâ”€â”€ visualization/      # å¯è§†åŒ–
â”‚   â””â”€â”€ GraphManager.java   # å›¾ç®¡ç†å™¨
â”œâ”€â”€ hook/                   # Hooksç³»ç»Ÿ
â”‚   â”œâ”€â”€ HookCondition.java  # Hookæ¡ä»¶
â”‚   â”œâ”€â”€ HookContext.java    # Hookä¸Šä¸‹æ–‡
â”‚   â”œâ”€â”€ HookExecutor.java   # Hookæ‰§è¡Œå™¨
â”‚   â”œâ”€â”€ HookLoader.java     # HookåŠ è½½å™¨
â”‚   â”œâ”€â”€ HookRegistry.java   # Hookæ³¨å†Œè¡¨
â”‚   â”œâ”€â”€ HookSpec.java       # Hookè§„èŒƒ
â”‚   â”œâ”€â”€ HookTrigger.java    # Hookè§¦å‘å™¨
â”‚   â””â”€â”€ HookType.java       # Hookç±»å‹
â”œâ”€â”€ llm/                    # LLMé›†æˆ
â”‚   â”œâ”€â”€ message/            # æ¶ˆæ¯æ¨¡å‹
â”‚   â”œâ”€â”€ provider/           # LLMæä¾›å•†å®ç°
â”‚   â”œâ”€â”€ ChatProvider.java   # èŠå¤©æä¾›å•†æ¥å£
â”‚   â”œâ”€â”€ LLM.java            # LLMåŒ…è£…ç±»
â”‚   â””â”€â”€ LLMFactory.java     # LLMå·¥å‚
â”œâ”€â”€ mcp/                    # MCPåè®®é›†æˆ
â”‚   â”œâ”€â”€ JsonRpcClient.java  # JSON-RPCå®¢æˆ·ç«¯æ¥å£
â”‚   â”œâ”€â”€ HttpJsonRpcClient.java # HTTPå®¢æˆ·ç«¯å®ç°
â”‚   â”œâ”€â”€ StdIoJsonRpcClient.java # StdIOå®¢æˆ·ç«¯å®ç°
â”‚   â””â”€â”€ MCPConfig.java      # MCPé…ç½®
â”œâ”€â”€ session/                # ä¼šè¯ç®¡ç†
â”‚   â”œâ”€â”€ Session.java        # ä¼šè¯æ¨¡å‹
â”‚   â”œâ”€â”€ SessionManager.java # ä¼šè¯ç®¡ç†å™¨
â”‚   â””â”€â”€ WorkDirMetadata.java # å·¥ä½œç›®å½•å…ƒæ•°æ®
â”œâ”€â”€ skill/                  # Skillsç³»ç»Ÿ
â”‚   â”œâ”€â”€ SkillConfig.java    # Skillsé…ç½®
â”‚   â”œâ”€â”€ SkillLoader.java    # SkillsåŠ è½½å™¨
â”‚   â”œâ”€â”€ SkillMatcher.java   # SkillsåŒ¹é…å™¨
â”‚   â”œâ”€â”€ SkillProvider.java  # Skillsæä¾›è€…
â”‚   â”œâ”€â”€ SkillRegistry.java  # Skillsæ³¨å†Œè¡¨
â”‚   â””â”€â”€ SkillSpec.java      # Skillsè§„èŒƒ
â”œâ”€â”€ tool/                   # å·¥å…·ç³»ç»Ÿ
â”‚   â”œâ”€â”€ bash/               # Shellå·¥å…·
â”‚   â”œâ”€â”€ file/               # æ–‡ä»¶æ“ä½œå·¥å…·
â”‚   â”œâ”€â”€ graph/              # ä»£ç å›¾å·¥å…·
â”‚   â”œâ”€â”€ human/              # äººå·¥äº¤äº’å·¥å…·
â”‚   â”œâ”€â”€ mcp/                # MCPå·¥å…·
â”‚   â”œâ”€â”€ task/               # å­Agentä»»åŠ¡å·¥å…·
â”‚   â”œâ”€â”€ think/              # æ€è€ƒå·¥å…·
â”‚   â”œâ”€â”€ todo/               # å¾…åŠäº‹é¡¹å·¥å…·
â”‚   â”œâ”€â”€ web/                # ç½‘ç»œå·¥å…·
â”‚   â”œâ”€â”€ Tool.java           # å·¥å…·æ¥å£
â”‚   â”œâ”€â”€ ToolProvider.java   # å·¥å…·æä¾›è€…æ¥å£
â”‚   â”œâ”€â”€ ToolRegistry.java   # å·¥å…·æ³¨å†Œè¡¨
â”‚   â””â”€â”€ ToolRegistryFactory.java # å·¥å…·æ³¨å†Œè¡¨å·¥å‚
â”œâ”€â”€ ui/                     # ç”¨æˆ·ç•Œé¢
â”‚   â””â”€â”€ shell/              # Shelläº¤äº’ç•Œé¢
â”‚       â”œâ”€â”€ ShellUI.java    # Shell UIä¸»ç±»
â”‚       â””â”€â”€ OutputFormatter.java # è¾“å‡ºæ ¼å¼åŒ–
â”œâ”€â”€ wire/                   # æ¶ˆæ¯æ€»çº¿
â”‚   â”œâ”€â”€ message/            # å„ç±»æ¶ˆæ¯å®šä¹‰
â”‚   â”œâ”€â”€ Wire.java           # æ¶ˆæ¯æ€»çº¿æ¥å£
â”‚   â””â”€â”€ WireImpl.java       # æ¶ˆæ¯æ€»çº¿å®ç°
â”œâ”€â”€ JimiApplication.java    # Spring Bootå¯åŠ¨ç±»
â””â”€â”€ JimiFactory.java        # Jimiå·¥å‚ç±»

src/main/resources/
â”œâ”€â”€ agents/                 # Agenté…ç½®ç›®å½•
â”‚   â”œâ”€â”€ default/            # é»˜è®¤Agent
â”‚   â”œâ”€â”€ design/             # è®¾è®¡Agent
â”‚   â”œâ”€â”€ code/               # ç¼–ç Agent
â”‚   â”œâ”€â”€ review/             # å®¡æŸ¥Agent
â”‚   â””â”€â”€ build/              # æ„å»ºAgent
â”œâ”€â”€ commands/               # è‡ªå®šä¹‰å‘½ä»¤é…ç½®
â”œâ”€â”€ hooks/                  # Hooksé…ç½®ç›®å½•
â”œâ”€â”€ skills/                 # Skillsé…ç½®ç›®å½•
â”‚   â”œâ”€â”€ code-review/        # ä»£ç å®¡æŸ¥Skill
â”‚   â””â”€â”€ unit-testing/       # å•å…ƒæµ‹è¯•Skill
â”œâ”€â”€ mcp/                    # MCPé…ç½®ç¤ºä¾‹
â”œâ”€â”€ application.yml         # Spring Booté…ç½®
â””â”€â”€ logback-spring.xml      # æ—¥å¿—é…ç½®
```

---

## ğŸš€ å®‰è£…ä¸é…ç½®

### ç¯å¢ƒè¦æ±‚

- **Java**: 17 æˆ–æ›´é«˜ç‰ˆæœ¬
- **Maven**: 3.6 æˆ–æ›´é«˜ç‰ˆæœ¬
- **æ“ä½œç³»ç»Ÿ**: macOSã€Linux æˆ– Windows

### å¿«é€Ÿå®‰è£…ï¼ˆæ¨èï¼‰

ä½¿ç”¨ä¸€é”®å®‰è£…è„šæœ¬ï¼š

```bash
# å…‹éš†æˆ–ä¸‹è½½é¡¹ç›®
cd /path/to/Jimi

# è¿è¡Œä¸€é”®å®‰è£…è„šæœ¬
./scripts/quick-install.sh
```

è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆï¼š
1. âœ… ç¯å¢ƒæ£€æŸ¥
2. âœ… ä¾èµ–å®‰è£…ï¼ˆå¦‚éœ€è¦ï¼‰
3. âœ… é¡¹ç›®æ„å»º
4. âœ… é…ç½®åˆå§‹åŒ–
5. âœ… å¯åŠ¨æœåŠ¡

### åˆ†æ­¥å®‰è£…

#### 1. æ£€æŸ¥ç¯å¢ƒ

```bash
./scripts/check-env.sh
```

#### 2. å®‰è£…ä¾èµ–ï¼ˆå¦‚éœ€è¦ï¼‰

```bash
./scripts/install-deps.sh
```

#### 3. æ„å»ºé¡¹ç›®

```bash
# è·³è¿‡æµ‹è¯•å¿«é€Ÿæ„å»º
./scripts/build.sh --skip-tests

# å®Œæ•´æ„å»º
./scripts/build.sh
```

#### 4. åˆå§‹åŒ–é…ç½®

```bash
./scripts/init-config.sh
```

é…ç½®å‘å¯¼ä¼šå¼•å¯¼æ‚¨å®Œæˆï¼š
- LLMæœåŠ¡æä¾›å•†é€‰æ‹©ï¼ˆOpenAIã€Moonshotç­‰ï¼‰
- API Keyé…ç½®
- æ¨¡å‹é€‰æ‹©
- é«˜çº§å‚æ•°è®¾ç½®

#### 5. å¯åŠ¨Jimi

```bash
./scripts/start.sh
```

### é…ç½®æ–‡ä»¶è¯´æ˜

#### application.yml
ä½ç½®ï¼š`src/main/resources/application.yml`

Spring Bootåº”ç”¨é…ç½®ï¼ŒåŒ…æ‹¬ï¼š
- æ—¥å¿—çº§åˆ«é…ç½®
- Jacksonåºåˆ—åŒ–é…ç½®
- SkillsåŠŸèƒ½å¼€å…³ä¸å‚æ•°

#### config.json
ä½ç½®ï¼š`~/.jimi/config.json`

ç”¨æˆ·é…ç½®æ–‡ä»¶ï¼ŒåŒ…æ‹¬ï¼š
- LLMæä¾›å•†é…ç½®ï¼ˆAPI Keyã€Base URLï¼‰
- é»˜è®¤æ¨¡å‹é€‰æ‹©
- å¾ªç¯æ§åˆ¶å‚æ•°
- åŠŸèƒ½å¼€å…³ï¼ˆSkillsã€å®¡æ‰¹ã€YOLOæ¨¡å¼ï¼‰

ç¤ºä¾‹é…ç½®ï¼š
```json
{
  "llm": {
    "providers": {
      "moonshot": {
        "apiKey": "your-api-key-here",
        "baseUrl": "https://api.moonshot.cn/v1"
      }
    },
    "defaultProvider": "moonshot",
    "defaultModel": "moonshot-v1-8k"
  },
  "loopControl": {
    "maxSteps": 50,
    "maxRuntime": 3600
  },
  "features": {
    "enableSkills": false,
    "enableApproval": false,
    "enableYoloMode": false
  }
}
```

---

## ğŸ¯ å¿«é€Ÿå¼€å§‹

### åŸºæœ¬ä½¿ç”¨

1. **å¯åŠ¨Jimi**
```bash
./scripts/start.sh
```

2. **æŸ¥çœ‹å¸®åŠ©**
```
/help
```

3. **å¼€å§‹å¯¹è¯**
```
ä½ å¥½ï¼Œè¯·å¸®æˆ‘åˆ†æä¸€ä¸‹è¿™ä¸ªJavaé¡¹ç›®çš„ç»“æ„
```

### å¸¸ç”¨å‘½ä»¤

#### å…ƒå‘½ä»¤
- `/help, /h, /?` - æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
- `/quit, /exit` - é€€å‡ºç¨‹åº
- `/version, /v` - æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯
- `/status` - æ˜¾ç¤ºå½“å‰çŠ¶æ€
- `/config` - æ˜¾ç¤ºé…ç½®ä¿¡æ¯
- `/tools` - æ˜¾ç¤ºå¯ç”¨å·¥å…·åˆ—è¡¨
- `/clear, /cls` - æ¸…å±
- `/history` - æ˜¾ç¤ºå‘½ä»¤å†å²
- `/reset` - æ¸…é™¤ä¸Šä¸‹æ–‡å†å²
- `/compact` - å‹ç¼©ä¸Šä¸‹æ–‡
- `/init` - åˆ†æä»£ç åº“å¹¶ç”Ÿæˆæ–‡æ¡£
- `/graph` - ä»£ç å›¾ç®¡ç†å‘½ä»¤
  - `/graph build` - æ„å»ºä»£ç å›¾
  - `/graph stats` - æŸ¥çœ‹å›¾ç»Ÿè®¡ä¿¡æ¯
  - `/graph rebuild` - é‡æ–°æ„å»ºä»£ç å›¾
- `/hooks` - Hooksç®¡ç†å‘½ä»¤
  - `/hooks list` - åˆ—å‡ºæ‰€æœ‰Hooks
  - `/hooks reload` - é‡æ–°åŠ è½½Hooks
  - `/hooks enable <name>` - å¯ç”¨Hook
  - `/hooks disable <name>` - ç¦ç”¨Hook
- `/commands` - è‡ªå®šä¹‰å‘½ä»¤ç®¡ç†
  - `/commands list` - åˆ—å‡ºæ‰€æœ‰è‡ªå®šä¹‰å‘½ä»¤
  - `/commands reload` - é‡æ–°åŠ è½½å‘½ä»¤
  - `/commands enable <name>` - å¯ç”¨å‘½ä»¤
  - `/commands disable <name>` - ç¦ç”¨å‘½ä»¤

#### Shellå¿«æ·æ–¹å¼
```
! ls -la        # æ‰§è¡ŒShellå‘½ä»¤
! pwd           # æ˜¾ç¤ºå½“å‰ç›®å½•
! mvn test      # è¿è¡ŒMavenæµ‹è¯•
```

### ä½¿ç”¨ç¤ºä¾‹

#### ç¤ºä¾‹1ï¼šä»£ç åˆ†æ
```
è¯·åˆ†æsrc/main/java/io/leavesfly/jimi/JimiEngine.javaçš„è®¾è®¡æ¨¡å¼
```

#### ç¤ºä¾‹2ï¼šä»£ç ç”Ÿæˆ
```
è¯·å¸®æˆ‘å®ç°ä¸€ä¸ªç”¨æˆ·æ³¨å†ŒåŠŸèƒ½ï¼ŒåŒ…æ‹¬å‚æ•°éªŒè¯å’Œå¼‚å¸¸å¤„ç†
```

#### ç¤ºä¾‹3ï¼šä»»åŠ¡å§”æ‰˜
```
è¯·ä½¿ç”¨è®¾è®¡Agentå¸®æˆ‘è®¾è®¡ä¸€ä¸ªç”µå•†ç³»ç»Ÿçš„è®¢å•æ¨¡å—æ¶æ„
```

#### ç¤ºä¾‹4ï¼šä»£ç å®¡æŸ¥
```
è¯·å®¡æŸ¥UserService.javaçš„ä»£ç è´¨é‡å’Œæ½œåœ¨é—®é¢˜
```

---

## ğŸ”§ ä½¿ç”¨æŒ‡å—

### å·¥ä½œæ¨¡å¼

#### 1. äº¤äº’å¼æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰
ç›´æ¥ä¸Jimiå¯¹è¯ï¼Œé€æ­¥è§£å†³é—®é¢˜ï¼š
```bash
./scripts/start.sh
```

#### 2. å‘½ä»¤æ¨¡å¼
é€šè¿‡å‘½ä»¤è¡Œå‚æ•°ç›´æ¥æ‰§è¡Œä»»åŠ¡ï¼š
```bash
./scripts/start.sh -c "è¯·å¸®æˆ‘åˆ†æè¿™ä¸ªé¡¹ç›®"
```

#### 3. YOLOæ¨¡å¼
è‡ªåŠ¨æ‰¹å‡†æ‰€æœ‰æ“ä½œï¼Œæ— éœ€äººå·¥ç¡®è®¤ï¼š
```bash
./scripts/start.sh --yolo
```

### æŒ‡å®šAgent

ä½¿ç”¨ç‰¹å®šAgentå¤„ç†ä»»åŠ¡ï¼š
```bash
# ä½¿ç”¨è®¾è®¡Agent
./scripts/start.sh --agent design

# ä½¿ç”¨ç¼–ç Agent
./scripts/start.sh --agent code

# ä½¿ç”¨è‡ªå®šä¹‰Agenté…ç½®
./scripts/start.sh --agent-file /path/to/custom-agent.yaml
```

### æŒ‡å®šå·¥ä½œç›®å½•

```bash
./scripts/start.sh --work-dir /path/to/project
```

### ä¼šè¯ç®¡ç†

```bash
# ä½¿ç”¨æŒ‡å®šä¼šè¯
./scripts/start.sh --session my-project

# æ¢å¤ä¸Šæ¬¡ä¼šè¯
./scripts/start.sh --resume
```

---

## ğŸ› ï¸ æ‰©å±•æ€§è¯´æ˜

### è‡ªå®šä¹‰Agent

1. **åˆ›å»ºAgenté…ç½®æ–‡ä»¶**

åœ¨`src/main/resources/agents/`ç›®å½•ä¸‹åˆ›å»ºæ–°çš„Agentç›®å½•ï¼š

```
agents/
â””â”€â”€ my-custom-agent/
    â”œâ”€â”€ agent.yaml          # Agenté…ç½®
    â””â”€â”€ system_prompt.md    # ç³»ç»Ÿæç¤ºè¯
```

2. **agent.yamlç¤ºä¾‹**
```yaml
name: My Custom Agent
description: æˆ‘çš„è‡ªå®šä¹‰Agent
subagents:
  - code
  - review
tools:
  - read_file
  - write_to_file
  - bash
skills: []
```

3. **ä½¿ç”¨è‡ªå®šä¹‰Agent**
```bash
./scripts/start.sh --agent my-custom-agent
```

### è‡ªå®šä¹‰å·¥å…·

1. **å®ç°ToolProvideræ¥å£**

```java
@Component
public class MyToolProvider implements ToolProvider {
    
    @Override
    public List<Tool> getTools(ToolRegistry registry) {
        return List.of(new MyCustomTool());
    }
}
```

2. **å®ç°Toolæ¥å£**

```java
public class MyCustomTool extends AbstractTool<MyParams> {
    
    @Override
    public String getName() {
        return "my_custom_tool";
    }
    
    @Override
    public String getDescription() {
        return "æˆ‘çš„è‡ªå®šä¹‰å·¥å…·";
    }
    
    @Override
    protected Mono<ToolResult> executeInternal(MyParams params) {
        // å·¥å…·é€»è¾‘å®ç°
        return Mono.just(ToolResult.success("æ‰§è¡ŒæˆåŠŸ"));
    }
}
```

### è‡ªå®šä¹‰å‘½ä»¤

1. **åˆ›å»ºå‘½ä»¤é…ç½®æ–‡ä»¶**

åœ¨`~/.jimi/commands/`æˆ–é¡¹ç›®çš„`.jimi/commands/`ç›®å½•ä¸‹åˆ›å»ºå‘½ä»¤é…ç½®ï¼š

```yaml
name: "quick-build"
description: "å¿«é€Ÿæ„å»ºå¹¶è¿è¡Œæµ‹è¯•"
category: "build"

aliases:
  - "qb"

usage: "/quick-build [--skip-tests]"

parameters:
  - name: "skip-tests"
    type: "boolean"
    defaultValue: "false"

execution:
  type: "script"
  script: |
    #!/bin/bash
    if [ "$SKIP_TESTS" = "true" ]; then
      mvn clean install -DskipTests
    else
      mvn clean install
    fi
  timeout: 300

preconditions:
  - type: "file_exists"
    path: "pom.xml"
```

2. **ä½¿ç”¨è‡ªå®šä¹‰å‘½ä»¤**
```bash
/quick-build
/qb --skip-tests
```

è¯¦ç»†ä½¿ç”¨è¯·å‚è€ƒï¼š[docs/CUSTOM_COMMANDS.md](docs/CUSTOM_COMMANDS.md)

### è‡ªå®šä¹‰Hooks

1. **åˆ›å»ºHooké…ç½®æ–‡ä»¶**

åœ¨`~/.jimi/hooks/`æˆ–é¡¹ç›®çš„`.jimi/hooks/`ç›®å½•ä¸‹åˆ›å»ºHooké…ç½®ï¼š

```yaml
name: "auto-format-java"
description: "ä¿å­˜Javaæ–‡ä»¶åè‡ªåŠ¨æ ¼å¼åŒ–"
enabled: true
priority: 10

trigger:
  type: "POST_TOOL_CALL"
  tools:
    - "WriteFile"
    - "StrReplaceFile"
  file_patterns:
    - "*.java"

execution:
  type: "script"
  script: |
    #!/bin/bash
    for file in ${MODIFIED_FILES}; do
      google-java-format -i "$file"
      echo "âœ… å·²æ ¼å¼åŒ–: $file"
    done
  workingDir: "${JIMI_WORK_DIR}"
  timeout: 30
```

2. **Hookç±»å‹**
- `PRE_TOOL_CALL` - å·¥å…·æ‰§è¡Œå‰
- `POST_TOOL_CALL` - å·¥å…·æ‰§è¡Œå
- `PRE_AGENT_SWITCH` - Agentåˆ‡æ¢å‰
- `POST_AGENT_SWITCH` - Agentåˆ‡æ¢å
- `ON_ERROR` - é”™è¯¯å‘ç”Ÿæ—¶
- `ON_SESSION_START` - ä¼šè¯å¯åŠ¨æ—¶
- `ON_SESSION_END` - ä¼šè¯ç»“æŸæ—¶

è¯¦ç»†ä½¿ç”¨è¯·å‚è€ƒï¼š[docs/HOOKS.md](docs/HOOKS.md)

1. **å®ç°CommandHandleræ¥å£**

```java
@Component
public class MyCommandHandler implements CommandHandler {
    
    @Override
    public String getCommand() {
        return "mycommand";
    }
    
    @Override
    public String getDescription() {
        return "æˆ‘çš„è‡ªå®šä¹‰å‘½ä»¤";
    }
    
    @Override
    public void handle(CommandContext context) {
        // å‘½ä»¤å¤„ç†é€»è¾‘
    }
}
```

2. **Springè‡ªåŠ¨æ³¨å†Œ**

Springä¼šè‡ªåŠ¨æ‰«æå¹¶æ³¨å†Œæ‰€æœ‰`CommandHandler`å®ç°ã€‚

### é›†æˆMCPå·¥å…·

1. **åˆ›å»ºMCPé…ç½®æ–‡ä»¶**

åœ¨`src/main/resources/mcp/`ç›®å½•ä¸‹åˆ›å»ºé…ç½®ï¼š

```json
{
  "name": "my-service",
  "description": "æˆ‘çš„MCPæœåŠ¡",
  "type": "http",
  "config": {
    "url": "http://localhost:8080"
  }
}
```

2. **å¯åŠ¨æ—¶åŠ è½½**
```bash
./scripts/start.sh --mcp-config-file src/main/resources/mcp/my-service.json
```

---

## ğŸ“š è¿›é˜¶åŠŸèƒ½

### ä»£ç å›¾(Code Graph)

ä»£ç å›¾åŠŸèƒ½åŸºäºLocAgentè®ºæ–‡å®ç°,æä¾›å¼ºå¤§çš„ä»£ç ç†è§£å’Œå¯¼èˆªèƒ½åŠ›ã€‚

#### å¯ç”¨ä»£ç å›¾

1. **é…ç½®`application.yml`**
```yaml
jimi:
  graph:
    enabled: true
    auto-build: false
    build-on-startup: false
    include-patterns:
      - "**/*.java"
    exclude-patterns:
      - "**/test/**"
      - "**/target/**"
```

2. **æ„å»ºä»£ç å›¾**
```bash
jimi> /graph build
å¼€å§‹æ„å»ºä»£ç å›¾...
é¡¹ç›®è·¯å¾„: /path/to/project

âœ… ä»£ç å›¾æ„å»ºå®Œæˆ

ç»Ÿè®¡ä¿¡æ¯:
  å®ä½“æ•°: 1523
  å…³ç³»æ•°: 3847
  è€—æ—¶: 2345ms
```

3. **ä½¿ç”¨ä»£ç å›¾å·¥å…·**

Agentä¼šè‡ªåŠ¨è·å¾—ä»¥ä¸‹å·¥å…·ï¼š
- **CodeLocateTool**: æ™ºèƒ½ä»£ç å®šä½
- **ImpactAnalysisTool**: å½±å“åˆ†æ
- **CallGraphTool**: è°ƒç”¨å›¾æŸ¥è¯¢

```bash
jimi> æŸ¥æ‰¾GraphManagerç±»çš„è°ƒç”¨å…³ç³»
jimi> åˆ†æä¿®æ”¹GraphBuilderçš„å½±å“
```

è¯¦ç»†ä½¿ç”¨è¯·å‚è€ƒï¼š[docs/GRAPH_GUIDE.md](docs/GRAPH_GUIDE.md)

### Hooksç³»ç»Ÿ

Hooksç³»ç»Ÿæ˜¯Jimiçš„äº‹ä»¶é©±åŠ¨è‡ªåŠ¨åŒ–æœºåˆ¶,å…è®¸åœ¨å…³é”®èŠ‚ç‚¹è‡ªåŠ¨æ‰§è¡Œè‡ªå®šä¹‰æ“ä½œã€‚

#### å¸¸è§åœºæ™¯

1. **è‡ªåŠ¨ä»£ç æ ¼å¼åŒ–**
```yaml
trigger:
  type: "POST_TOOL_CALL"
  tools:
    - "WriteFile"
  file_patterns:
    - "*.java"

execution:
  type: "script"
  script: "google-java-format -i ${MODIFIED_FILE}"
```

2. **Gitæäº¤å‰æµ‹è¯•**
```yaml
trigger:
  type: "PRE_TOOL_CALL"
  tools:
    - "Bash"

execution:
  type: "script"
  script: |
    if [[ "${TOOL_RESULT}" == *"git commit"* ]]; then
      mvn test || exit 1
    fi
```

3. **é”™è¯¯è‡ªåŠ¨ä¿®å¤**
```yaml
trigger:
  type: "ON_ERROR"
  errorPattern: ".*compilation error.*"

execution:
  type: "agent"
  agent: "Code-Agent"
  task: "åˆ†æç¼–è¯‘é”™è¯¯å¹¶è‡ªåŠ¨ä¿®å¤"
```

è¯¦ç»†ä½¿ç”¨è¯·å‚è€ƒï¼š[docs/HOOKS.md](docs/HOOKS.md)

### è‡ªå®šä¹‰å‘½ä»¤

é€šè¿‡YAMLé…ç½®æ–‡ä»¶åˆ›å»ºè‡ªå®šä¹‰å‘½ä»¤,æ— éœ€ç¼–å†™Javaä»£ç ã€‚

#### æ”¯æŒçš„æ‰§è¡Œç±»å‹

1. **Scriptç±»å‹**: æ‰§è¡ŒShellè„šæœ¬
2. **Agentç±»å‹**: å§”æ‰˜ç»™Agentæ‰§è¡Œ
3. **Compositeç±»å‹**: ç»„åˆå¤šä¸ªæ­¥éª¤

#### ç¤ºä¾‹ï¼šå¿«é€Ÿæ„å»ºå‘½ä»¤

```yaml
name: "quick-build"
description: "å¿«é€Ÿæ„å»ºå¹¶è¿è¡Œæµ‹è¯•"

aliases:
  - "qb"

parameters:
  - name: "skip-tests"
    type: "boolean"
    defaultValue: "false"

execution:
  type: "script"
  script: |
    if [ "$SKIP_TESTS" = "true" ]; then
      mvn clean install -DskipTests
    else
      mvn clean install
    fi
```

ä½¿ç”¨ï¼š
```bash
/quick-build
/qb --skip-tests
```

è¯¦ç»†ä½¿ç”¨è¯·å‚è€ƒï¼š[docs/CUSTOM_COMMANDS.md](docs/CUSTOM_COMMANDS.md)

### ReCAPè®°å¿†ä¼˜åŒ–

ReCAP(é€’å½’ä¸Šä¸‹æ–‡æ„ŸçŸ¥æ¨ç†ä¸è§„åˆ’)æ˜¯Jimiçš„è®°å¿†ä¼˜åŒ–æœºåˆ¶,è§£å†³é•¿ä»»åŠ¡é“¾å’Œå¤š Subagent åä½œåœºæ™¯ä¸‹çš„è®°å¿†ç®¡ç†æŒ‘æˆ˜ã€‚

#### æ ¸å¿ƒæœºåˆ¶

1. **æœ‰ç•Œæ´»åŠ¨æç¤º**ï¼šä¿æŒæç¤ºå¤§å°O(1),é¿å…æ— é™å¢é•¿
2. **ç»“æ„åŒ–ä¸Šä¸‹æ–‡æ¢å¤**ï¼šçˆ¶å­Agenté—´è¯­ä¹‰è¿ç»­æ€§
3. **å…³é”®å‘ç°å‹ç¼©**ï¼šé«˜å±‚æ„å›¾+æ‘˜è¦å¼å…³é”®å‘ç°å§‹ç»ˆä¿æŒ

#### é…ç½®å¯ç”¨

åœ¨`application.yml`ä¸­é…ç½®ï¼š

```yaml
jimi:
  memory:
    # æœ‰ç•Œæç¤ºæœ€å¤§Tokenæ•°
    activePromptMaxTokens: 4000
    
    # å…³é”®å‘ç°çª—å£å¤§å°
    insightsWindowSize: 5
    
    # å¯ç”¨ReCAPä¼˜åŒ–
    enableRecap: true
    
    # æœ€å¤§é€’å½’æ·±åº¦
    maxRecursionDepth: 5
```

#### ä¼˜åŒ–æ•ˆæœ

- æç¤ºå¤§å°ä»O(n)å˜ä¸ºO(1)
- Tokenæ¶ˆè€—èŠ‚çœ30-50%
- æ”¯æŒæ·±åº¦é€’å½’Subagentåä½œ(æœ€å¤š5å±‚)
- é«˜å±‚æ„å›¾å’Œå…³é”®ä¿¡æ¯ä¸ä¸¢å¤±

è¯¦ç»†ä½¿ç”¨è¯·å‚è€ƒï¼š[docs/ReCAPè®°å¿†ä¼˜åŒ–æŠ€æœ¯æ–¹æ¡ˆ.md](docs/ReCAPè®°å¿†ä¼˜åŒ–æŠ€æœ¯æ–¹æ¡ˆ.md)

### Skillsç³»ç»Ÿ

Skillsæ˜¯Jimiçš„çŸ¥è¯†æ³¨å…¥æœºåˆ¶ï¼Œå…è®¸å°†é¢†åŸŸä¸“ä¸šçŸ¥è¯†æ¨¡å—åŒ–å¹¶è‡ªåŠ¨æ¿€æ´»ã€‚

#### åˆ›å»ºSkill

1. **åˆ›å»ºSkillç›®å½•**
```
skills/
â””â”€â”€ my-skill/
    â””â”€â”€ skill.yaml
```

2. **skill.yamlç¤ºä¾‹**
```yaml
name: My Skill
description: æˆ‘çš„ä¸“ä¸šæŠ€èƒ½
keywords:
  - å…³é”®è¯1
  - å…³é”®è¯2
content: |
  è¿™é‡Œæ˜¯Skillçš„è¯¦ç»†å†…å®¹ï¼ŒåŒ…æ‹¬ï¼š
  - ä¸“ä¸šçŸ¥è¯†
  - æœ€ä½³å®è·µ
  - ä»£ç ç¤ºä¾‹
  - æ³¨æ„äº‹é¡¹
```

#### å¯ç”¨SkillsåŠŸèƒ½

åœ¨`application.yml`ä¸­ï¼š
```yaml
jimi:
  skill:
    enabled: true
    auto-match: true
```

### ä¸Šä¸‹æ–‡å‹ç¼©

å½“å¯¹è¯å†å²è¿‡é•¿æ—¶ï¼Œè‡ªåŠ¨å‹ç¼©ä¸Šä¸‹æ–‡ä»¥èŠ‚çœTokenï¼š

```
/compact
```

æ‰‹åŠ¨è§¦å‘å‹ç¼©ï¼Œæˆ–ç­‰å¾…è‡ªåŠ¨è§¦å‘ï¼ˆåŸºäºTokené˜ˆå€¼ï¼‰ã€‚

### å®¡æ‰¹æœºåˆ¶

å¯¹äºæ•æ„Ÿæ“ä½œï¼ˆå¦‚æ–‡ä»¶å†™å…¥ã€å‘½ä»¤æ‰§è¡Œï¼‰ï¼Œéœ€è¦äººå·¥å®¡æ‰¹ï¼š

```
# åœ¨é…ç½®ä¸­å¯ç”¨
"features": {
  "enableApproval": true
}
```

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

æˆ‘ä»¬æ¬¢è¿ç¤¾åŒºè´¡çŒ®ï¼ä»¥ä¸‹æ˜¯å‚ä¸è´¡çŒ®çš„æ–¹å¼ï¼š

### å¦‚ä½•è´¡çŒ®

1. **Forkæœ¬ä»“åº“**
2. **åˆ›å»ºç‰¹æ€§åˆ†æ”¯** (`git checkout -b feature/AmazingFeature`)
3. **æäº¤æ›´æ”¹** (`git commit -m 'Add some AmazingFeature'`)
4. **æ¨é€åˆ°åˆ†æ”¯** (`git push origin feature/AmazingFeature`)
5. **å¼€å¯Pull Request**

### è´¡çŒ®ç±»å‹

- ğŸ› Bugä¿®å¤
- âœ¨ æ–°åŠŸèƒ½å¼€å‘
- ğŸ“ æ–‡æ¡£æ”¹è¿›
- ğŸ¨ ä»£ç é‡æ„
- âš¡ æ€§èƒ½ä¼˜åŒ–
- âœ… æµ‹è¯•ç”¨ä¾‹è¡¥å……
- ğŸŒ å›½é™…åŒ–æ”¯æŒ

### ä»£ç è§„èŒƒ

- éµå¾ªJavaç¼–ç è§„èŒƒ
- ä½¿ç”¨Lombokç®€åŒ–ä»£ç 
- ç¼–å†™å•å…ƒæµ‹è¯•
- æ·»åŠ å¿…è¦çš„æ³¨é‡Š
- ä¿æŒä»£ç ç®€æ´æ¸…æ™°

### æäº¤è§„èŒƒ

ä½¿ç”¨è¯­ä¹‰åŒ–çš„æäº¤ä¿¡æ¯ï¼š
```
feat: æ·»åŠ æ–°åŠŸèƒ½
fix: ä¿®å¤Bug
docs: æ›´æ–°æ–‡æ¡£
style: ä»£ç æ ¼å¼è°ƒæ•´
refactor: ä»£ç é‡æ„
test: æµ‹è¯•ç›¸å…³
chore: æ„å»º/å·¥å…·é“¾ç›¸å…³
```

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ Apache License 2.0 è®¸å¯è¯ã€‚è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

---

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹å¼€æºé¡¹ç›®å’Œç¤¾åŒºï¼š

- [Spring Boot](https://spring.io/projects/spring-boot) - ä¼ä¸šçº§åº”ç”¨æ¡†æ¶
- [Project Reactor](https://projectreactor.io/) - å“åº”å¼ç¼–ç¨‹åº“
- [Picocli](https://picocli.info/) - å‘½ä»¤è¡Œè§£ææ¡†æ¶
- [JLine](https://github.com/jline/jline3) - ç»ˆç«¯äº¤äº’åº“
- [Caffeine](https://github.com/ben-manes/caffeine) - é«˜æ€§èƒ½ç¼“å­˜
- [Model Context Protocol](https://modelcontextprotocol.io/) - AIå·¥å…·æ ‡å‡†åè®®

---

## ğŸ“ è”ç³»æˆ‘ä»¬

- **Issues**: [GitHub Issues](https://github.com/your-repo/jimi/issues)
- **Discussions**: [GitHub Discussions](https://github.com/your-repo/jimi/discussions)
- **æ–‡æ¡£**: [é¡¹ç›®æ–‡æ¡£](.qoder/repowiki/)

---

## ğŸŒŸ Star History

å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™æˆ‘ä»¬ä¸€ä¸ª â­ï¸ Starï¼

---

**Happy Coding with Jimi! ğŸ‰**
